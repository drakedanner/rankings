// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Show {
  id             String    @id @default(uuid())
  name           String
  season         Int
  network        String
  tags           String[]
  score          Decimal   @db.Decimal(3, 1)
  tier           String
  year           Int       @default(2025) // production year (single source of truth for rankings)
  category       String    @default("tv") // tv | movies (year-scoped rankings; food is separate)
  absolute_rank  Int?
  description    String?
  cover_url      String?
  tvmaze_id      Int?
  tvmaze_rating  Decimal?  @db.Decimal(3, 1)
  created_at     DateTime  @default(now())
  updated_at     DateTime  @updatedAt
  episodes       Episode[]

  @@index([year])
  @@index([category, year])
}

model Episode {
  id               String   @id @default(uuid())
  showId           String
  show             Show     @relation(fields: [showId], references: [id], onDelete: Cascade)
  tvmaze_episode_id Int     @unique
  name             String
  season           Int
  number           Int
  airdate          DateTime?
  summary          String?
  runtime          Int?
  image_url        String?
  rating           Decimal? @db.Decimal(3, 1)
  created_at       DateTime @default(now())
  updated_at       DateTime @updatedAt

  @@index([showId])
}

model Spot {
  id           String   @id @default(uuid())
  name         String
  tagline      String   // e.g. "deep dish pizza", "burger and wine bar"
  neighborhood String?  // e.g. "North End"
  city         String   @default("Boston")
  latitude     Float?   // for map plotting
  longitude    Float?
  created_at   DateTime @default(now())
  updated_at   DateTime @updatedAt
}
